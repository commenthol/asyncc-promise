!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n(t.asyncc=t.asyncc||{})}(this,function(t){"use strict";function n(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];return function(n){return new Promise(function(e,o){new j(r([function(){return Promise.resolve(n)}].concat(t)),e,o)})}}function r(t){return t.reduce(function(t,n){return t.concat(Array.isArray(n)?r(n):n)},[])}function e(t,n){return new Promise(function(r,e){new g(n,t,{},r,e)})}function o(t,n){return e(t,function(t){return!n(t)})}function i(t,n,r,e){return new Promise(function(o,i){new E(t,n,r,e,o,i)})}function s(t,n,r){return i(0,t,n,r)}function c(t,n){return new Promise(function(r,e){new m(t,n,r,e)})}function u(t,n,r){return new Promise(function(e,o){new A(t,n,r,e,o)})}function p(t,n){return u(0,t,n)}function h(t,n){var r={};return"object"==typeof t&&(r=t,t=t.times),new Promise(function(e,o){new k(t||2,n,r,e,o)})}function f(t){return new Promise(function(n,r){new v(t,n,r)})}function a(t,n){var r={};return"object"==typeof t&&(r=t,t=t.times),new Promise(function(e,o){new O(t,n,r,e,o)})}function l(t,n){return new Promise(function(r,e){new w(t,n,{},r,e)})}function y(t,n){return l(function(n){return!t(n)},n)}var b=function(t){function n(n,r,e,o){t.call(this,n),Object.assign(this,{name:"AsynccError",message:n,errors:r,errpos:e,results:o,stack:this.stack||(new t).stack})}return t&&(n.__proto__=t),n.prototype=Object.create(t&&t.prototype),n.prototype.constructor=n,n}(Error),_=function(t,n,r){Object.assign(this,{length:t,resolve:n,reject:r,results:[],i:0}),this.cb=this.cb.bind(this),this.run=this.run.bind(this)};_.prototype.cb=function(t,n){var r=this,e=r.results,o=r.length,i=r.i;e.push(n),t?(t="object"==typeof t?t:new Error(t),this.reject(Object.assign(t,{results:e}))):o===i?this.resolve(e):i<o&&this.run()},_.prototype.run=function(){};var m=function(t){function n(n,r,e,o){t.call(this,n.length,e,o),Object.assign(this,{items:n,task:r}),this.run()}return t&&(n.__proto__=t),n.prototype=Object.create(t&&t.prototype),n.prototype.constructor=n,n.prototype.run=function(){var t=this,n=t.items,r=t.task,e=t.cb;r(n[this.i],this.i++).then(function(t){return e(null,t)}).catch(function(t){return e(t)})},n}(_),v=function(t){function n(n,r,e){t.call(this,n.length,r,e),this.tasks=n,this.run()}return t&&(n.__proto__=t),n.prototype=Object.create(t&&t.prototype),n.prototype.constructor=n,n.prototype.run=function(t){var n=this;this.tasks[this.i++](t).then(function(t){return n.cb(null,t)}).catch(function(t){return n.cb(t)})},n}(_),j=function(t){function n(){t.apply(this,arguments)}return t&&(n.__proto__=t),n.prototype=Object.create(t&&t.prototype),n.prototype.constructor=n,n.prototype.cb=function(t,n){var r=this,e=r.length,o=r.i;t?(t="object"==typeof t?t:new Error(t),this.reject(t)):e===o?this.resolve(n):o<e&&this.run(n)},n}(v),d=function(t,n,r,e,o){void 0===r&&(r={}),Object.assign(this,{test:t,task:n,opts:r,resolve:e,reject:o,i:0,cb:this.cb.bind(this),run:this.run.bind(this),init:this.init.bind(this)})};d.prototype.init=function(){var t=this,n=t.test,r=t.run,e=t.i,o=t.resolve;n(e)?o():r()},d.prototype.cb=function(t,n){var r=this,e=r.resolve,o=r.reject,i=r.run,s=r.test,c=r.i;t?(t="object"==typeof t?t:new Error(t),o(t)):s(c)?e(n):i()},d.prototype.run=function(){var t=this,n=t.cb;(0,t.task)(this.i++).then(function(t){return n(null,t)}).catch(function(t){return n(t)})};var w=function(t){function n(n,r,e,o,i){t.call(this,n,r,e,o,i),this.init()}return t&&(n.__proto__=t),n.prototype=Object.create(t&&t.prototype),n.prototype.constructor=n,n}(d),g=function(t){function n(){t.apply(this,arguments)}return t&&(n.__proto__=t),n.prototype=Object.create(t&&t.prototype),n.prototype.constructor=n,n.prototype.init=function(){this.run()},n}(w),O=function(t){function n(n,r,e,o,i){var s=function(t){return n>0&&t>=n};t.call(this,s,r,e,o,i),this.times=n,this.init()}return t&&(n.__proto__=t),n.prototype=Object.create(t&&t.prototype),n.prototype.constructor=n,n.prototype.init=function(){var t=this,n=t.times,r=t.run,e=t.resolve;n?r():e()},n.prototype.run=function(){var n=this;if(!this.i||!this.opts.lag)return void t.prototype.run.call(this);setTimeout(function(){t.prototype.run.call(n)},this.opts.lag)},n}(d),k=function(t){function n(){t.apply(this,arguments)}return t&&(n.__proto__=t),n.prototype=Object.create(t&&t.prototype),n.prototype.constructor=n,n.prototype.cb=function(t,n){var r=this,e=r.resolve,o=r.reject,i=r.run,s=r.test,c=r.i;!t||s(c)?t?(t="object"==typeof t?t:new Error(t),o(t)):e(n):i()},n}(O),P=function(t,n,r,e,o){var i=this;t=Math.abs(t||n),t=t<n?t:n,Object.assign(this,{opts:r||{},resolve:e,reject:o,error:new b("err",new Array(n).fill(),[]),results:new Array(n).fill(),done:0,i:0,l:n,length:n,limit:t}),this.opts.timeout&&setTimeout(function(){i.l&&i.final("err_timeout")},this.opts.timeout),this.run=this.run.bind(this),this.cb=this.cb.bind(this),this.final=this.final.bind(this)};P.prototype.init=function(){for(var t=this;this.i<this.limit;)t.run(t.i++)},P.prototype.final=function(t){var n=this,r=n.error,e=n.results;this.done++||(r.errpos.length||t?(t&&(r.message=t),this.reject(Object.assign(r,{results:e}))):this.resolve(e))},P.prototype.cb=function(t,n,r){var e=this,o=e.error,i=e.results,s=e.opts;if(i[t]=r,o.errors[t]=n,n&&(o.errpos.push(t),s.bail))return void this.final("err_bail");this.l--,this.i<this.length?this.run(this.i++):this.l||this.final()},P.prototype.run=function(){};var E=function(t){function n(n,r,e,o,i,s){t.call(this,n,r.length,o,i,s),Object.assign(this,{items:r,task:e}),this.init()}return t&&(n.__proto__=t),n.prototype=Object.create(t&&t.prototype),n.prototype.constructor=n,n.prototype.run=function(t){var n=this;this.task(this.items[t],t).then(function(r){return n.cb(t,null,r)}).catch(function(r){return n.cb(t,r)})},n}(P),A=function(t){function n(n,r,e,o,i){t.call(this,n,r.length,e,o,i),Object.assign(this,{tasks:r}),this.init()}return t&&(n.__proto__=t),n.prototype=Object.create(t&&t.prototype),n.prototype.constructor=n,n.prototype.run=function(t){var n=this;this.tasks[t]().then(function(r){return n.cb(t,null,r)}).catch(function(r){return n.cb(t,r)})},n}(P),L=function(t){return function(){for(var n=[],r=arguments.length;r--;)n[r]=arguments[r];return new Promise(function(r,e){t.apply(void 0,n.concat([function(t,n){t?e(t):r(n)}]))})}},x={AsynccError:b,compose:n,doUntil:e,doWhilst:o,each:s,eachLimit:i,eachSeries:c,parallel:p,parallelLimit:u,promisify:L,retry:h,series:f,times:a,until:l,whilst:y};t.default=x,t.AsynccError=b,t.compose=n,t.doUntil=e,t.doWhilst=o,t.each=s,t.eachLimit=i,t.eachSeries=c,t.parallel=p,t.parallelLimit=u,t.promisify=L,t.retry=h,t.series=f,t.times=a,t.until=l,t.whilst=y,Object.defineProperty(t,"__esModule",{value:!0})});